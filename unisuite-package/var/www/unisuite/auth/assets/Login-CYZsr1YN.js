import{_ as F,u as k,M as E,a as b,T as y,c as L,b as t,w as A,t as r,d as f,e as d,v as m,f as g,g as h,h as _,F as x,r as I,o as M}from"./index-D8G455MK.js";import{a as w}from"./axios-CCb-kr4I.js";const T={data(){return{year:new Date().getFullYear(),form:{username:"",password:"",token:{a:"",b:"",c:"",d:"",e:"",f:""}},errorMessage:"",modal2FA:"",rememberMe:!1}},mounted(){const s=k();s.appSidebarHide=!0,s.appHeaderHide=!0,s.appFooter=!1,s.appContentClass="p-0",this.modal2FA=new E(document.getElementById("modal2FA"));const e=document.querySelectorAll(".otp-field > input"),l=this.$refs.submit2FAButton;window.addEventListener("load",()=>e[0].focus()),l.setAttribute("disabled","disabled"),document.getElementById("modal2FA").addEventListener("hide.bs.modal",()=>{this.form.token={a:"",b:"",c:"",d:"",e:"",f:""},e.forEach(o=>{o.value="",o.setAttribute("disabled","disabled")}),e[0].removeAttribute("disabled"),e[0].focus(),l.classList.remove("active"),l.setAttribute("disabled","disabled")});const u=()=>{Array.from(e).every(a=>a.value!=="")?(l.classList.add("active"),l.removeAttribute("disabled")):(l.classList.remove("active"),l.setAttribute("disabled","disabled"))};e.forEach((o,a)=>{o.addEventListener("input",()=>{let n=o.value.replace(/\D/g,"");n.length>1&&(n=n.slice(0,1)),o.value=n,o.value&&a<e.length-1&&(e[a+1].removeAttribute("disabled"),e[a+1].focus()),this.form.token[Object.keys(this.form.token)[a]]=o.value,u()}),o.addEventListener("keydown",n=>{n.key==="ArrowLeft"&&a>0?(e[a-1].focus(),setTimeout(()=>e[a-1].setSelectionRange(1,1),0)):n.key==="ArrowRight"&&a<e.length-1?(e[a+1].focus(),setTimeout(()=>e[a+1].setSelectionRange(1,1),0)):(n.key==="Backspace"||n.key==="Delete")&&o.value===""&&(a>0&&(e[a-1].focus(),e[a-1].value="",this.form.token[Object.keys(this.form.token)[a-1]]="",setTimeout(()=>e[a-1].setSelectionRange(1,1),0)),o.value="",this.form.token[Object.keys(this.form.token)[a]]="")}),o.addEventListener("paste",n=>{n.preventDefault();const v=n.clipboardData.getData("text").trim().split("").filter(c=>/\d/.test(c));v.forEach((c,p)=>{p<e.length&&(e[p].value=c,this.form.token[Object.keys(this.form.token)[p]]=c,e[p].removeAttribute("disabled"))}),u(),e[Math.min(v.length,e.length-1)].focus()})}),e.forEach((o,a)=>{a>0&&o.setAttribute("disabled","disabled")})},beforeUnmount(){const s=k();s.appSidebarHide=!1,s.appHeaderHide=!1,s.appFooter=!0,s.appContentClass=""},methods:{validateInputs(s,e){Array.from(s).every(u=>u.value!=="")?(e.classList.add("active"),e.removeAttribute("disabled")):(e.classList.remove("active"),e.setAttribute("disabled","disabled"))},async submitForm(){try{const s=await w.post("https://api.unisuite.de/auth/login",{username:this.form.username,password:this.form.password}),e={domain:".unisuite.de",path:"/",sameSite:"None",secure:!0,expires:this.rememberMe?1:void 0};b.set("id_token",s.data.id_token,e),b.set("access_token",s.data.access_token,e),window.location.href="https://app.unisuite.de/"}catch(s){s.response&&s.response.data=="2FA token required"?this.modal2FA.toggle():(this.errorMessage=s.response?s.response.data:"Die Anfrage konnte nicht verarbeitet werden. Versuche es später erneut!",new y(document.getElementById("toastError")).show())}},async submit2FA(){const s=`${this.form.token.a}${this.form.token.b}${this.form.token.c}${this.form.token.d}${this.form.token.e}${this.form.token.f}`;try{const e=await w.post("https://api.unisuite.de/auth/login",{username:this.form.username,password:this.form.password,token:s}),l={domain:".unisuite.de",path:"/",sameSite:"None",secure:!0,expires:this.rememberMe?1:void 0};b.set("id_token",e.data.id_token,l),b.set("access_token",e.data.access_token,l),window.location.href="https://app.unisuite.de/"}catch(e){this.modal2FA.toggle(),this.errorMessage=e.response?e.response.data:"Dein Code konnte nicht geprüft werden. Versuche es später erneut!",new y(document.getElementById("toastError")).show()}},togglePWV(){const s=document.getElementById("pweye"),e=document.getElementById("pwField");s.classList.contains("fa-eye")?(s.classList.replace("fa-eye","fa-eye-slash"),e.type="text"):(s.classList.replace("fa-eye-slash","fa-eye"),e.type="password")}}},O={class:"login"},S={class:"login-content"},V={class:"text-center"},D={class:"text-inverse text-opacity-50 text-center mb-4"},U={class:"mb-3"},C={class:"d-flex"},B={class:"form-label"},N={class:"input-group flex-nowrap"},R={class:"mb-3"},H={class:"d-flex"},q={class:"form-label"},P={class:"input-group flex-nowrap"},G={class:"mb-3"},j={class:"row align-items-center"},W={class:"col-6"},z={class:"form-check"},J={class:"form-check-label",for:"rememberCheck"},K={class:"col-6 text-end"},Y={type:"submit",class:"btn btn-outline-theme btn-lg d-block w-100 fw-500 mb-3"},Z={class:"fixed-bottom mb-2 text-center small text-inverse text-opacity-50"},Q={href:"https://unisuite.de/",target:"_blank"},X={class:"modal fade",id:"modal2FA","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"modal2FALabel","aria-hidden":"true"},$={class:"modal-dialog modal-dialog-centered"},ee={class:"modal-content"},te={class:"modal-body"},se={class:"row d-flex justify-content-center"},oe={class:"modal-footer"},ae={type:"submit",class:"btn btn-primary",form:"2faForm",ref:"submit2FAButton"},ie={class:"toasts-container"},ne={class:"toast bg-warning bg-opacity-50","data-autohide":"true",id:"toastError"},le={class:"toast-body"};function re(s,e,l,u,o,a){const n=I("RouterLink");return M(),L(x,null,[t("div",O,[t("div",S,[t("form",{onSubmit:e[4]||(e[4]=A((...i)=>a.submitForm&&a.submitForm(...i),["prevent"]))},[t("h1",V,r(s.$t("AUTH.LOGIN.TITLE")),1),t("div",D,r(s.$t("AUTH.LOGIN.DESC")),1),t("div",U,[t("div",C,[t("label",B,[f(r(s.$t("GENERAL.EMAIL"))+" ",1),e[12]||(e[12]=t("span",{class:"text-danger"},"*",-1))])]),t("div",N,[e[13]||(e[13]=t("i",{class:"fa-solid fa-image-portrait input-group-text",id:"addon-wrapping"},null,-1)),d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.username=i),type:"email",class:"form-control form-control-lg bg-white bg-opacity-5 fs-14px",autocomplete:"email",required:""},null,512),[[m,o.form.username]])])]),t("div",R,[t("div",H,[t("label",q,[f(r(s.$t("GENERAL.PASSWORD"))+" ",1),e[14]||(e[14]=t("span",{class:"text-danger"},"*",-1))]),g(n,{to:"/recover",class:"ms-auto text-inverse text-decoration-none text-opacity-50"},{default:h(()=>[f(r(s.$t("AUTH.LOGIN.PWFORGOT")),1)]),_:1})]),t("div",P,[e[16]||(e[16]=t("i",{class:"fa-solid fa-key input-group-text",id:"addon-wrapping"},null,-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.password=i),type:"password",id:"pwField",class:"form-control form-control-lg bg-white bg-opacity-5 fs-14px",autocomplete:"password",required:""},null,512),[[m,o.form.password]]),t("button",{type:"button",onClick:e[2]||(e[2]=(...i)=>a.togglePWV&&a.togglePWV(...i)),class:"input-group-text"},e[15]||(e[15]=[t("i",{id:"pweye",class:"fa fa-eye"},null,-1)]))])]),t("div",G,[t("div",j,[t("div",W,[t("div",z,[d(t("input",{class:"form-check-input",type:"checkbox",id:"rememberCheck","onUpdate:modelValue":e[3]||(e[3]=i=>o.rememberMe=i)},null,512),[[_,o.rememberMe]]),t("label",J,r(s.$t("AUTH.LOGIN.REMEMBER")),1)])]),t("div",K,[g(n,{to:"",class:"text-body"},{default:h(()=>e[17]||(e[17]=[t("i",{class:"fa-brands fa-apple fa-xl m-2 align-middle",style:{height:"0.2em"}},null,-1)])),_:1}),g(n,{to:"",class:"text-body"},{default:h(()=>e[18]||(e[18]=[t("i",{class:"fa-brands fa-google fa-lg m-2 align-middle"},null,-1)])),_:1}),g(n,{to:"",class:"text-body"},{default:h(()=>e[19]||(e[19]=[t("i",{class:"fa-brands fa-microsoft fa-lg m-2 align-middle"},null,-1)])),_:1})])])]),t("button",Y,r(s.$t("AUTH.LOGIN.TITLE")),1)],32),t("div",Z,[f(" © "+r(o.year)+" ",1),t("a",Q,r(s.$t("APP.NAME")),1),f(" - "+r(s.$t("APP.LIC"))+". ",1)])])]),t("div",X,[t("div",$,[t("div",ee,[e[22]||(e[22]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"modal2FALabel"},"2-Faktor Authentifizierung")],-1)),t("div",te,[t("div",se,[e[20]||(e[20]=t("div",{class:"col-12 text-center"},"Da Sie die Zwei-Faktor-Authentifizierung in Ihrem Konto eingerichtet haben, müssen Sie nun den Code aus Ihrer Authenticator-App (TOTP) eingeben, um mit der Anmeldung fortzufahren.",-1)),t("form",{id:"2faForm",class:"otp-field col-3 mt-3",onSubmit:e[11]||(e[11]=A((...i)=>a.submit2FA&&a.submit2FA(...i),["prevent"]))},[d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>o.form.token.a=i),type:"text",inputmode:"numeric",class:"form-control",autocomplete:"one-time-code",autofocus:"",required:""},null,512),[[m,o.form.token.a]]),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>o.form.token.b=i),type:"text",inputmode:"numeric",class:"form-control",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.b]]),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.token.c=i),type:"text",inputmode:"numeric",class:"form-control",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.c]]),d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.token.d=i),type:"text",inputmode:"numeric",class:"form-control",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.d]]),d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>o.form.token.e=i),type:"text",inputmode:"numeric",class:"form-control",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.e]]),d(t("input",{"onUpdate:modelValue":e[10]||(e[10]=i=>o.form.token.f=i),type:"text",inputmode:"numeric",class:"form-control",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.f]])],32)])]),t("div",oe,[e[21]||(e[21]=t("button",{type:"button",class:"btn btn-outline-default","data-bs-dismiss":"modal"},"Abbrechen",-1)),t("button",ae,"Anmelden",512)])])])]),t("div",ie,[t("div",ne,[e[23]||(e[23]=t("div",{class:"toast-header"},[t("i",{class:"far fa-triangle-exclamation text-muted me-2"}),t("strong",{class:"me-auto"},"Fehler"),t("small",null,"Jetzt")],-1)),t("div",le,r(this.errorMessage),1)])])],64)}const ue=F(T,[["render",re]]);export{ue as default};
