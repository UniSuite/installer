import{_ as F,u as y,M as x,a as b,T as k,c as _,b as t,w,t as l,d as p,e as d,v as m,f as g,g as h,h as E,F as L,r as M,o as T}from"./index-QBX28yvm.js";import{a as A}from"./axios-CCb-kr4I.js";const I={data(){return{year:new Date().getFullYear(),form:{username:"",password:"",token:{a:"",b:"",c:"",d:"",e:"",f:""}},errorMessage:"",modal2FA:"",rememberMe:!1}},mounted(){const s=y();s.appSidebarHide=!0,s.appHeaderHide=!0,s.appFooter=!1,s.appContentClass="p-0",this.modal2FA=new x(document.getElementById("modal2FA"));const e=document.querySelectorAll(".otp-field > input"),r=this.$refs.submit2FAButton;window.addEventListener("load",()=>e[0].focus()),r.setAttribute("disabled","disabled");const u=()=>{Array.from(e).every(a=>a.value!=="")?(r.classList.add("active"),r.removeAttribute("disabled")):(r.classList.remove("active"),r.setAttribute("disabled","disabled"))};e.forEach((o,a)=>{o.addEventListener("input",()=>{o.value.length>1&&(o.value=o.value.slice(0,1)),o.value&&a<e.length-1&&(e[a+1].removeAttribute("disabled"),e[a+1].focus()),u()}),o.addEventListener("keydown",i=>{i.key==="ArrowLeft"&&a>0?(e[a-1].focus(),setTimeout(()=>e[a-1].setSelectionRange(1,1),0)):i.key==="ArrowRight"&&a<e.length-1?(e[a+1].focus(),setTimeout(()=>e[a+1].setSelectionRange(1,1),0)):(i.key==="Backspace"||i.key==="Delete")&&o.value===""&&a>0&&(e[a-1].focus(),e[a-1].value="",setTimeout(()=>e[a-1].setSelectionRange(1,1),0))}),o.addEventListener("paste",i=>{i.preventDefault();const v=i.clipboardData.getData("text").trim().split("").filter(c=>/\d/.test(c));v.forEach((c,f)=>{f<e.length&&(e[f].value=c,this.form.token[Object.keys(this.form.token)[f]]=c,e[f].removeAttribute("disabled"))}),u(),e[Math.min(v.length,e.length-1)].focus()})}),e.forEach((o,a)=>{a>0&&o.setAttribute("disabled","disabled")})},beforeUnmount(){const s=y();s.appSidebarHide=!1,s.appHeaderHide=!1,s.appFooter=!0,s.appContentClass=""},methods:{validateInputs(s,e){Array.from(s).every(u=>u.value!=="")?(e.classList.add("active"),e.removeAttribute("disabled")):(e.classList.remove("active"),e.setAttribute("disabled","disabled"))},async submitForm(){try{const s=await A.post("https://api.unisuite.de/auth/login",{username:this.form.username,password:this.form.password}),e={domain:".unisuite.de",path:"/",sameSite:"None",secure:!0,expires:this.rememberMe?1:void 0};b.set("id_token",s.data.id_token,e),b.set("access_token",s.data.access_token,e),window.location.href="https://app.unisuite.de/"}catch(s){s.response&&s.response.data=="2FA token required"?this.modal2FA.toggle():(this.errorMessage=s.response?s.response.data:"Die Anfrage konnte nicht verarbeitet werden. Versuche es später erneut!",new k(document.getElementById("toastError")).show())}},async submit2FA(){const s=`${this.form.token.a}${this.form.token.b}${this.form.token.c}${this.form.token.d}${this.form.token.e}${this.form.token.f}`;try{const e=await A.post("https://api.unisuite.de/auth/login",{username:this.form.username,password:this.form.password,token:s}),r={domain:".unisuite.de",path:"/",sameSite:"None",secure:!0,expires:this.rememberMe?1:void 0};b.set("id_token",e.data.id_token,r),b.set("access_token",e.data.access_token,r),window.location.href="https://app.unisuite.de/"}catch(e){this.errorMessage=e.response?e.response.data:"Dein Code konnte nicht geprüft werden. Versuche es später erneut!",new k(document.getElementById("toastError")).show()}},togglePWV(){const s=document.getElementById("pweye"),e=document.getElementById("pwField");s.classList.contains("fa-eye")?(s.classList.replace("fa-eye","fa-eye-slash"),e.type="text"):(s.classList.replace("fa-eye-slash","fa-eye"),e.type="password")}}},S={class:"login"},V={class:"login-content"},O={class:"text-center"},U={class:"text-inverse text-opacity-50 text-center mb-4"},C={class:"mb-3"},D={class:"d-flex"},N={class:"form-label"},B={class:"input-group flex-nowrap"},R={class:"mb-3"},H={class:"d-flex"},q={class:"form-label"},P={class:"input-group flex-nowrap"},G={class:"mb-3"},W={class:"row align-items-center"},z={class:"col-6"},j={class:"form-check"},J={class:"form-check-label",for:"rememberCheck"},K={class:"col-6 text-end"},Y={type:"submit",class:"btn btn-outline-theme btn-lg d-block w-100 fw-500 mb-3"},Z={class:"fixed-bottom mb-2 text-center small text-inverse text-opacity-50"},Q={href:"https://unisuite.de/",target:"_blank"},X={class:"modal fade",id:"modal2FA","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"modal2FALabel","aria-hidden":"true"},$={class:"modal-dialog modal-dialog-centered"},ee={class:"modal-content"},te={class:"modal-body"},se={class:"row d-flex justify-content-center"},oe={class:"modal-footer"},ae={type:"submit",class:"btn btn-primary",form:"2faForm",ref:"submit2FAButton"},ne={class:"toasts-container"},ie={class:"toast bg-warning bg-opacity-50","data-autohide":"true",id:"toastError"},le={class:"toast-body"};function re(s,e,r,u,o,a){const i=M("RouterLink");return T(),_(L,null,[t("div",S,[t("div",V,[t("form",{onSubmit:e[4]||(e[4]=w((...n)=>a.submitForm&&a.submitForm(...n),["prevent"]))},[t("h1",O,l(s.$t("AUTH.LOGIN.TITLE")),1),t("div",U,l(s.$t("AUTH.LOGIN.DESC")),1),t("div",C,[t("div",D,[t("label",N,[p(l(s.$t("GENERAL.EMAIL"))+" ",1),e[12]||(e[12]=t("span",{class:"text-danger"},"*",-1))])]),t("div",B,[e[13]||(e[13]=t("i",{class:"fa-solid fa-image-portrait input-group-text",id:"addon-wrapping"},null,-1)),d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>o.form.username=n),type:"email",class:"form-control form-control-lg bg-white bg-opacity-5 fs-14px",autocomplete:"email",required:""},null,512),[[m,o.form.username]])])]),t("div",R,[t("div",H,[t("label",q,[p(l(s.$t("GENERAL.PASSWORD"))+" ",1),e[14]||(e[14]=t("span",{class:"text-danger"},"*",-1))]),g(i,{to:"/recover",class:"ms-auto text-inverse text-decoration-none text-opacity-50"},{default:h(()=>[p(l(s.$t("AUTH.LOGIN.PWFORGOT")),1)]),_:1})]),t("div",P,[e[16]||(e[16]=t("i",{class:"fa-solid fa-key input-group-text",id:"addon-wrapping"},null,-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>o.form.password=n),type:"password",id:"pwField",class:"form-control form-control-lg bg-white bg-opacity-5 fs-14px",autocomplete:"password",required:""},null,512),[[m,o.form.password]]),t("button",{type:"button",onClick:e[2]||(e[2]=(...n)=>a.togglePWV&&a.togglePWV(...n)),class:"input-group-text"},e[15]||(e[15]=[t("i",{id:"pweye",class:"fa fa-eye"},null,-1)]))])]),t("div",G,[t("div",W,[t("div",z,[t("div",j,[d(t("input",{class:"form-check-input",type:"checkbox",id:"rememberCheck","onUpdate:modelValue":e[3]||(e[3]=n=>o.rememberMe=n)},null,512),[[E,o.rememberMe]]),t("label",J,l(s.$t("AUTH.LOGIN.REMEMBER")),1)])]),t("div",K,[g(i,{to:"",class:"text-body"},{default:h(()=>e[17]||(e[17]=[t("i",{class:"fa-brands fa-apple fa-xl m-2 align-middle",style:{height:"0.2em"}},null,-1)])),_:1}),g(i,{to:"",class:"text-body"},{default:h(()=>e[18]||(e[18]=[t("i",{class:"fa-brands fa-google fa-lg m-2 align-middle"},null,-1)])),_:1}),g(i,{to:"",class:"text-body"},{default:h(()=>e[19]||(e[19]=[t("i",{class:"fa-brands fa-microsoft fa-lg m-2 align-middle"},null,-1)])),_:1})])])]),t("button",Y,l(s.$t("AUTH.LOGIN.TITLE")),1)],32),t("div",Z,[p(" © "+l(o.year)+" ",1),t("a",Q,l(s.$t("APP.NAME")),1),p(" - "+l(s.$t("APP.LIC"))+". ",1)])])]),t("div",X,[t("div",$,[t("div",ee,[e[22]||(e[22]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"modal2FALabel"},"2-Faktor Authentifizierung")],-1)),t("div",te,[t("div",se,[e[20]||(e[20]=t("div",{class:"col-12 text-center"},"Da Sie die Zwei-Faktor-Authentifizierung in Ihrem Konto eingerichtet haben, müssen Sie nun den Code aus Ihrer Authenticator-App (TOTP) eingeben, um mit der Anmeldung fortzufahren.",-1)),t("form",{id:"2faForm",class:"otp-field col-3 mt-3",onSubmit:e[11]||(e[11]=w((...n)=>a.submit2FA&&a.submit2FA(...n),["prevent"]))},[d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>o.form.token.a=n),type:"text",inputmode:"numeric",class:"form-control",autocomplete:"one-time-code",autofocus:"",required:""},null,512),[[m,o.form.token.a]]),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>o.form.token.b=n),type:"text",inputmode:"numeric",class:"form-control",autocomplete:"one-time-code",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.b]]),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>o.form.token.c=n),type:"text",inputmode:"numeric",class:"form-control",autocomplete:"one-time-code",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.c]]),d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>o.form.token.d=n),type:"text",inputmode:"numeric",class:"form-control",autocomplete:"one-time-code",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.d]]),d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>o.form.token.e=n),type:"text",inputmode:"numeric",class:"form-control",autocomplete:"one-time-code",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.e]]),d(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>o.form.token.f=n),type:"text",inputmode:"numeric",class:"form-control",autocomplete:"one-time-code",autofocus:"",required:"",disabled:""},null,512),[[m,o.form.token.f]])],32)])]),t("div",oe,[e[21]||(e[21]=t("button",{type:"button",class:"btn btn-outline-default","data-bs-dismiss":"modal"},"Abbrechen",-1)),t("button",ae,"Anmelden",512)])])])]),t("div",ne,[t("div",ie,[e[23]||(e[23]=t("div",{class:"toast-header"},[t("i",{class:"far fa-triangle-exclamation text-muted me-2"}),t("strong",{class:"me-auto"},"Fehler"),t("small",null,"Jetzt")],-1)),t("div",le,l(this.errorMessage),1)])])],64)}const ue=F(I,[["render",re]]);export{ue as default};
